{% extends 'base.html' %}
{% load static %}

{% block title %}Shop{% endblock %}

{% block content %}
<div class="container shop-page-container">
    <h1 class="text-center mb-4">Our Products</h1>

    {% if products %}
    <div class="product-list">

        {% for product in products %}
        <div class="product-card">

            <!-- IMAGE -->
            <div class="product-image-wrapper">
                {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}">
                {% else %}
                    <img src="{% static 'images/placeholder.jpg' %}" alt="No Image">
                {% endif %}
            </div>

            <!-- INFO -->
            <h2 class="mt-3">{{ product.name }}</h2>
            <p class="price">‚Çπ{{ product.price }}</p>

            <div class="mt-3 d-flex justify-content-center gap-2">
                <!-- üî• AJAX BUTTON -->
                <button
                    class="btn btn-primary btn-sm"
                    onclick="addToCart({{ product.id }})">
                    Add to Cart
                </button>

                <!-- NORMAL BUY NOW -->
                <a href="{% url 'store:buy_now' product.id %}"
                   class="btn btn-success btn-sm">
                    Buy Now
                </a>
            </div>

        </div>
        {% endfor %}

    </div>
    {% else %}
        <p class="text-center">No products available at the moment.</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
function addToCart(productId) {
    const url = "{% url 'store:ajax_add_to_cart' 0 %}".replace("0", productId);

    fetch(url, {
        method: "GET",
        headers: { "X-Requested-With": "XMLHttpRequest" }
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("Added to cart üõí");
        } else {
            alert("Failed ‚ùå");
        }
    })
    .catch(() => alert("Server error ‚ùå"));
}
</script>

{% endblock %}
