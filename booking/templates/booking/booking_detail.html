{% extends 'base.html' %}
{% load static %}

{% block title %}Booking Details - {{ booking.id }}{% endblock %}

{% block extra_css %}
<style>
    body {
        background-image: url('{% static "img/background_sports.jpg" %}');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        color: #f8f9fa;
    }
    .container-fluid.booking-details-wrapper {
        background-color: rgba(0, 0, 0, 0.85);
        padding: 40px 20px;
        min-height: 100vh;
        display: flex;
        justify-content: center;
    }
    .booking-card {
        background-color: #212529;
        border-radius: 12px;
        box-shadow: 0 0 25px rgba(0, 255, 0, 0.25);
        color: #e2e6ea;
        max-width: 900px;
        width: 100%;
    }
    .booking-card .card-header {
        background-color: #0d6efd;
        color: white;
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        padding: 1.5rem;
    }
    .status-success {
        color: #198754;
        font-weight: bold;
        text-transform: uppercase;
    }
    .status-pending {
        color: #ffc107;
        font-weight: bold;
        text-transform: uppercase;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid booking-details-wrapper">
    <div class="card booking-card mt-4">
        <div class="card-header">
            Booking ID: {{ booking.id }}
        </div>

        <div class="card-body p-4">

            <p><strong>User:</strong> {{ booking.user.username }}</p>

            <h4 class="mt-4">Event Details</h4>
            <p><strong>Event:</strong> {{ booking.event.name }}</p>
            <p><strong>Tickets:</strong> {{ booking.num_tickets }}</p>
            <p><strong>Total Price:</strong> ‚Çπ{{ booking.total_price }}</p>

            <p>
                <strong>Payment Status:</strong>
                <span class="{% if booking.payment_status == 'successful' %}status-success{% else %}status-pending{% endif %}">
                    {{ booking.payment_status|capfirst }}
                </span>
            </p>

            {% if booking.seats.exists %}
                <h4 class="mt-4">Selected Seats</h4>
                <ul>
                    {% for seat in booking.seats.all %}
                        <li>{{ seat.section }} ‚Äì Row {{ seat.row_number }}, Seat {{ seat.seat_number }}</li>
                    {% endfor %}
                </ul>
            {% endif %}

            <div class="mt-5 text-center border-top pt-4">

                {% if booking.payment_status == 'successful' %}

                    {% if tickets %}
                        <h5 class="text-success mb-3">Your Tickets</h5>
                        {% for ticket in tickets %}
                            <a href="{% url 'booking:download_ticket' ticket.ticket_id %}"
                               class="btn btn-success mb-2 d-block">
                                üéüÔ∏è Download Ticket ‚Äì {{ ticket.seat.section }} Seat {{ ticket.seat.seat_number }}
                            </a>
                        {% endfor %}
                    {% else %}
                        <p class="text-warning">Tickets are being generated. Please refresh.</p>
                    {% endif %}

                {% elif booking.payment_status == 'pending' %}

                    <a href="{% url 'booking:process_payment' booking.id %}"
                       class="btn btn-warning">
                        Pay Now
                    </a>

                {% endif %}

            </div>

        </div>
    </div>
</div>
{% endblock %}
